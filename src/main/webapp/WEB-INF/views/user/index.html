<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head thy:merge="/common::headerFragment">
<title>用户列表</title>
<style>
.hover {
	background-color: #cccc00;
}
</style>

<meta http-equiv="Content-Type" content="text/html; charset=GB2312" />
<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/

	$(document).ready(
			function() {
				$('#addBtn').bind('click', addUser);
				$('#checkAll').bind('click', checkAll);
				$('#deleteBtn').bind('click', function() {

					$("#confirmDiv").confirm({
						heading : '确认删除',
						body : '你真的要删除吗?',
						yesBtn : '是',
						noBtn : '否',
						callback : function() {
							batchDelete();

						}
					});

				});

				$("#userList").simpleTable("user/listUsers?sort=id&order=desc",
						render, $("#paginator"), null);
				/*
				 $.ajax({
				 url : "listPermissions?sort=id&order=desc",
				 success : function(data) {
				 paginator(data);

				 }
				 });
				 */
			});
	function render(data) {
		var newRow = "<tr><td><input type=\"checkbox\" name=\"selectFlag\" value=\""+data.id+"\"></input></td><td>"
				+ data.id
				+ "</td><td>"
				+ data.name
				+ "</td><td>"
				+ data.loginName
				+ "</td><td>"
				+ data.mobile
				+ "</td><td>"
				+ data.email
				+ "</td><td>"
				+ data.stauts
				+ "</td><td><a href=\"user/update/"+data.id+"\"><i class='icon-edit'></i></a></td></tr>";
		return newRow;
	};
	function checkAll() {

		if ($("#checkAll").prop("checked") == true) {
			//alert("checked");
			$("input[name='selectFlag']:checkbox").each(function() { //遍历所有的name为selectFlag的 checkbox
				$(this).prop("checked", true);
			});
		} else { //反之 取消全选 
			//alert("unchecked");
			$("input[name='selectFlag']:checkbox").each(function() { //遍历所有的name为selectFlag的 checkbox
				$(this).prop("checked", false);
				//alert("f");
			});
		}

	};
	function addUser() {
		//alert("create user...");
		$("#createUser").load(
				'user/create?' + (new Date()).valueOf(),
				function(data) {
					$("#createUser").bind(
							"evtSuccess",
							function(evt, data) {
								$("#createUser").modal("hide");
								$("#userList tr").nextAll().remove();
								$("#userList").simpleTable(
										"user/listUsers?sort=id&order=desc",
										render, $("#paginator"), null);
							});
					$("#createUser").modal();

				});
	};
	function batchDelete() {
		var selctedItems = new Array();
		$("input[name='selectFlag']:checkbox").each(function() { //遍历所有的name为selectFlag的 checkbox
			if ($(this).prop("checked") == true) {
				selctedItems.push($(this).prop("value"));
			}
		});

		$.ajax({
			type : "POST",
			url : "user",
			data : {
				_method : 'DELETE',
				items : selctedItems
			},
			//contentType : 'application/json',
			dataType : 'json',
			success : function(data) {
				$("#userList tr").nextAll().remove();
				$("#userList").simpleTable("user/listUsers?sort=id&order=desc",
						render, $("#paginator"), null);

			}
		});

	}
	/*]]>*/
</script>
</head>
<body>
	<div class="box">
		<h1>用户列表</h1>
		<table id="userList" cellpadding="0" cellspacing="0" border="0"
			class="table table-striped table-bordered">
			<thead>
				<tr>
					<th><input type="checkbox" id="checkAll" /></th>
					<th>Id</th>
					<th>Name</th>
					<th>LoginName</th>
					<th>Mobile</th>
					<th>Email</th>
					<th>Status</th>
					<th>Edit</th>
				</tr>
			</thead>
			<tbody>
				<tr th:remove="all">
					<td>Student01</td>
					<td>Languages</td>
					<td>male</td>
					<td>80</td>
					<td>70</td>
					<td>75</td>
				</tr>
				<tr th:remove="all">
					<td>Student02</td>
					<td>Languagesee</td>
					<td>female</td>
					<td>802</td>
					<td>703</td>
					<td>75e</td>
				</tr>
			</tbody>
		</table>
		<div id="paginator"></div>
		<input type="button" id="addBtn" value="增加" class="btn btn-primary" />
		<input type="button" id="deleteBtn" value="删除选中"
			class="btn btn-danger" />
	</div>
	<div tabindex="-1" class="modal hide fade" id="createUser"
		data-keyboard="false" data-backdrop="static"></div>
	<div id="confirmDiv"></div>
</body>
</html>
