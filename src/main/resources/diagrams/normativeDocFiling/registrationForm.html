<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head thy:merge="/common::headerFragment">
<title>规范性文件备案登记表</title>
<meta http-equiv="Content-Type" content="text/html; charset=GB2312" />
<link rel="stylesheet" href="../assets/css/datepicker.css"
	th:href="@{/assets/css/datepicker.css}" />
</head>
<body>
	<form id="myForm" method="POST" class="form-horizontal">
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="fileName">文件名称：</label>
			<div class="col-sm-9">
				<input type="text" name="fileName" id="fileName"
					class="col-xs-10 col-sm-5" />
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right">单位名称：</label>
			<div class="col-sm-9">
				<span id="organizationName" class="col-xs-10 col-sm-5"></span> <input
					type="hidden" id="organizationId" name="organizationId" />
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right"
				for="messageNumber">发文字号：</label>
			<div class="col-sm-9">
				<input class="col-xs-10 col-sm-5" type="text" name="messageNumber"
					id="messageNumber" />
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right"
				for="fileProperty">文件性质：</label>
			<div class="col-sm-9">
				<select id="fileProperty" name="fileProperty"
					class="col-xs-10 col-sm-5"><option value="党内规范性文件">党内规范性文件</option></select>
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right"
				for="contentClassification">内容分类：</label>
			<div class="col-sm-9">
				<select id="contentClassification" name="contentClassification"><option
						value="党员">党员</option>
					<option value="党的组织制度">党的组织制度</option>
					<option value="党组织">党组织</option>
					<option value="党的干部">党的干部</option>
					<option value="党的纪律">党的纪律</option>
					<option value="政治">政治</option>
					<option value="经济">经济</option>
					<option value="社会">社会</option>
					<option value="宣传">宣传</option>
					<option value="统战">统战</option>
					<option value="民族宗教">民族宗教</option>
					<option value="外事对台">外事对台</option>
					<option value="其他">其他</option>
				</select>
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label no-padding-right"
				for="datetimepicker1">发布时间(月/日/年)：</label>
			<div class="col-sm-4">
				<div class="input-group">
					<input class="form-control date-picker" id="datetimepicker1"
						type="text" data-date-format="mm/dd/yyyy" name="releaseDate" /> <span
						class="input-group-addon"> <i
						class="icon-calendar bigger-110"></i>
					</span>
				</div>
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 controle-label no-padding-right text-right"
				for="datetimepicker2">实施时间(月/日/年)：</label>
			<div class="col-sm-4">
				<div class="input-group">
					<input class="form-control date-picker" id="datetimepicker2"
						type="text" data-date-format="mm/dd/yyyy"
						name="implementationDate" /> <span class="input-group-addon">
						<i class="icon-calendar bigger-110"></i>
					</span>
				</div>
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 controle-label no-padding-right text-right"
				for="isOpen">是否公开：</label>
			<div class="col-sm-9" style="z-index: 0">
				<div class="radio-inline">
					<label> <input name="isOpen" type="radio" class="ace"
						value="是" /> <span class="lbl"> 是</span>
					</label>
				</div>
				<div class="radio-inline">
					<label> <input name="isOpen" type="radio" class="ace"
						value="否" /> <span class="lbl"> 否</span>
					</label>
				</div>
			</div>
			<div class="space-4"></div>
		</div>
		<div class="form-group">
			<div class="clearfix form-actions">
				<div class="col-md-offset-3 col-md-9">
					<button type="button" id="submitButton" class="btn btn-info">
						<i class="icon-ok bigger-110"></i>提交
					</button>
					<input type="hidden" name="attachmentList" id="attachmentList" />
				</div>
			</div>
		</div>
	</form>
	<div class="box">
		<label>上传附件：</label>
		<div>
			<ul id="uploadedAttachment"></ul>
		</div>
		<form id="uploadForm" class="form-horizontal"
			th:action="@{'/runtime/attachment/uploadAttachment/'+${taskId}}"
			method="post" enctype="multipart/form-data">
			<input type="file" id="id-input-file-1" name="file" />
			<div class="form-actions center">
				<button type="submit" class="btn btn-sm btn-success">
					点击上传 <i class="icon-arrow-up icon-on-right bigger-110"></i>
				</button>
			</div>
		</form>
	</div>
	<div th:replace="/common::javascriptFragment"></div>
	<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/
	var browserDetectUri = /*[[@{'/assets/js/browserDetect.js'}]]*/'/assets/js/browserDetect.js';
	//require(
	//	[ browserDetectUri ],
	//	function($) {
	$('#id-input-file-1').ace_file_input({
	    no_file : '没有文件 ...',
	    btn_choose : '选择',
	    btn_change : '选择',
	    droppable : false,
	    onchange : null,
	    thumbnail : false
	//| true | large
	//whitelist:'gif|png|jpg|jpeg'
	//blacklist:'exe|php'
	//onchange:''
	//
	//
	});

	$('.date-picker').datepicker({
	    language : 'zh-CN',
	    autoclose : true
	}).next().on(ace.click_event, function() {
	    $(this).prev().focus();
	});
	deleteAttachment = function(deleteUrl, attachmentId) {
	    $.ajax({
		type : "POST",
		url : deleteUrl + attachmentId,
		data : {
		    _method : 'DELETE',
		},
		success : function(data) {
		    var orignList = $("#attachmentList").val();
		    orignList = orignList.replace(attachmentId + ",", "");
		    $("#attachmentList").val(orignList);
		    $("#attachment" + attachmentId).remove();
		}
	    });
	};
	$
		.ajax({
		    type : 'GET',
		    url : /*[[@{'/user/getOrganization/'}+${T(org.apache.shiro.SecurityUtils).subject.principal.loginName}]]*/'',
		    async : true,
		    success : function(data) {
			//temp = $('#selectedUser').text();
			//temp += data + ';';
			$('#organizationName').text(data.text);
			$('#organizationId').val(data.id);

		    }

		});
	$("#submitButton")
		.click(
			function() {

			    $
				    .blockUI({
					message : '<h3><img src="bootstrap/img/ajax-loader.gif" /> 正在提交...</h3>'
				    });
			    $("#myForm")
				    .ajaxForm(
					    {
						url : /*[[@{'/runtime/form/submitTaskForm/'+${taskId}}]]*/"",
						dataType : "text",
						success : function(data) {
						    var ret = JSON.parse(data);
						    $
							    .teninedialog({
								title : '系统提示',
								content : ret.msg,
								dialogHidden : function() {

								}
							    });
						    $("#myForm").trigger(
							    "evtWFSuccess", {
								msg : "OK"
							    });
						    $.unblockUI();
						}

					    }).submit();

			});
	var options = {
	    beforeSend : function() {
		//   $("#progress").show();
		//clear everything
		//   $("#bar").width('0%').height('1px').css({
		//	background : "green"
		//   }).fadeIn("fast");
		;
		//   $("#message").html("").fadeIn("fast");
		//   $("#percent").html("0%").fadeIn("fast");
	    },
	    uploadProgress : function(event, position, total, percentComplete) {
		//   $("#bar").width(percentComplete + '%');
		//   $("#percent").html(percentComplete + '%');

	    },
	    success : function() {
		// $("#bar").width('100%').fadeOut("slow");

		// $("#percent").html('100%').fadeOut("slow");

	    },
	    complete : function(response) {
		var ret = JSON.parse(response.responseText);
		//  $("#message")
		//	    .html(
		//	    "<font color='green'>"
		//		    + response.responseText
		//		    + "</font>").fadeIn("fast")
		//    .fadeOut("slow");
		var li = $("<li></li>");

		var a = $("<a>" + ret.filename + "</a>");
		var deleteUrl = /*[[@{'/runtime/attachment/'}]]*/"";
		a.attr("href", "javascript:deleteAttachment(\"" + deleteUrl
			+ "\"," + ret.attachmentId + ");");
		var i = $("<i class=\"icon-remove\"></i>");
		i.appendTo(a);
		a.appendTo(li);
		li.attr("id", "attachment" + ret.attachmentId);
		li.appendTo($("#uploadedAttachment"));
		var orignList = $("#attachmentList").val();
		$("#attachmentList").val(orignList + "," + ret.attachmentId);
	    },
	    error : function() {
		//  $("#message")
		//	    .html(
		//		    "<font color='red'> 错误: 不能上传文件,请检查文件！</font>");
	    }
	};
	$("#uploadForm").ajaxForm(options);
	//});
	/*]]>*/
    </script>
</body>
</html>